# survey_queue_field_validation_api_v0.1
Turns on survey queue information and input field validation endpoints for the REDCap API.

## Usage
This module must be enabled on each project before the `surveyqueue` endpoint can be used for that project.
This module must be enabled at the system level before using the `fieldvalidation` endpoint.

Calls to this API are almost identical to the REDCap API, with the following changes.
1. URL must include the following GET parameters: prefix=[this_module_prefix], type=module, NOAUTH, page=[surveyqueue|fieldvalidation]
2. When using the `surveyqueue` endpoint, an additional `pid` get parameter must be provided pid=[project_id].

The module prefix is the name of the folder that contains the module without the version number. If you install the module in `redcap/modules/survey_queue_field_validation_api_v0.1` then the module prefix will be `survey_queue_field_validation_api`.

``` php
<?php

$data = array(
	'token' => '[token]',
	'format' => 'json',
	'returnFormat' => 'json'
);

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'http://redcap.[myinstitution].com/api/?prefix=[prefix]&page=[surveyqueue|fieldvalidation]&pid=[pid]&type=module&NOAUTH');
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);
curl_setopt($ch, CURLOPT_VERBOSE, 0);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_setopt($ch, CURLOPT_AUTOREFERER, true);
curl_setopt($ch, CURLOPT_MAXREDIRS, 10);
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');
curl_setopt($ch, CURLOPT_FRESH_CONNECT, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data, '', '&'));
$output = curl_exec($ch);
curl_close($ch);
```

The above code snippet will pull all the project survey queue info for the specified project ID or system field validation information as long as the provided API token is valid.
In the event that there are no survey instruments activated in the survey queue for the specified project, an empty json array will be returned.

## Survey Queue Output
The following is an example of the output generated by the 'surveyqueue' API endpoint for a specific project.
``` json
[{
	"queued_survey": "survey_1",
	"completed_survey": null,
	"completed_survey_event_id": null,
	"separator": "OR",
	"branching_logic": "[record_id] = 1",
	"auto_start": "1"
}, {
	"queued_survey": "survey_2",
	"completed_survey": "survey_1",
	"completed_survey_event_id": "107",
	"separator": "AND",
	"branching_logic": "[record_id] = 1",
	"auto_start": "0"
}]
```

## Field Validation Output
The following is the truncated output of the `fieldvalidation` API endpoint for an example installation of REDCap.
``` json
[{
	"validation_type": "alpha_only",
	"validation_label": "Letters only",
	"validation_type_class": "text",
	"regex": "\/^[a-z]+$\/i",
	"regex_js": "\/^[a-z]+$\/i"
}, {
	"validation_type": "date_dmy",
	"validation_label": "Date (D-M-Y)",
	"validation_type_class": "date",
	"regex": "\/^((29([-\\\/])02\\3(\\d{2}([13579][26]|[2468][048]|04|08)|(1600|2[048]00)))|((((0[1-9]|1\\d|2[0-8])([-\\\/])(0[1-9]|1[012]))|((29|30)([-\\\/])(0[13-9]|1[012]))|(31([-\\\/])(0[13578]|1[02])))(\\11|\\15|\\18)\\d{4}))$\/",
	"regex_js": "\/^((29([-\\\/])02\\3(\\d{2}([13579][26]|[2468][048]|04|08)|(1600|2[048]00)))|((((0[1-9]|1\\d|2[0-8])([-\\\/])(0[1-9]|1[012]))|((29|30)([-\\\/])(0[13-9]|1[012]))|(31([-\\\/])(0[13578]|1[02])))(\\11|\\15|\\18)\\d{4}))$\/"
}, ...
]
```